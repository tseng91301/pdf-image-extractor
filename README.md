# ğŸ“„ PDF åœ–ç‰‡æ“·å–èˆ‡åœ–èªªæ¨è«–ç³»çµ±

**PDF Image Extraction & Caption Inference System**

## ğŸ“‹ ç›®éŒ„

- [å°ˆæ¡ˆç°¡ä»‹](#å°ˆæ¡ˆç°¡ä»‹)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [å®‰è£æŒ‡å—](#å®‰è£æŒ‡å—)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [è©³ç´°ä½¿ç”¨æ–¹æ³•](#è©³ç´°ä½¿ç”¨æ–¹æ³•)
- [ç¨‹å¼é‹ä½œæµç¨‹](#ç¨‹å¼é‹ä½œæµç¨‹)
- [è¼¸å‡ºæ ¼å¼](#è¼¸å‡ºæ ¼å¼)
- [é—œéµæŠ€è¡“](#é—œéµæŠ€è¡“)
- [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
- [é–‹ç™¼é€²åº¦](#é–‹ç™¼é€²åº¦)

---

## å°ˆæ¡ˆç°¡ä»‹

æœ¬å°ˆæ¡ˆæ˜¯ä¸€å€‹å¼·å¤§çš„ **PDF åœ–ç‰‡æ“·å–èˆ‡åœ–èªªæ¨è«–ç³»çµ±**ï¼Œå°ˆé–€ç‚º**æƒæå‹ï¼ˆå½±åƒå‹ï¼‰PDF** è¨­è¨ˆï¼Œç”¨æ–¼è™•ç†ç¾å¯¦ä¸–ç•Œä¸­å“è³ªä¸ä¸€ã€æ–‡å­—å±¤æå£æˆ–ç¼ºå¤±çš„ PDF æ–‡ä»¶ã€‚

### ç‚ºä»€éº¼éœ€è¦é€™å€‹ç³»çµ±ï¼Ÿ

- ğŸ“„ **ç¾å¯¦ PDF å•é¡Œè¤‡é›œ**ï¼šæ–‡å­—å±¤ç¼ºå¤±ã€æ··åˆæ ¼å¼ã€æ’ç‰ˆä¸ç©©å®š
- ğŸ” **å‚³çµ±æ–¹æ¡ˆå¤±æ•ˆ**ï¼šç›´æ¥æå–æ–‡å­—å±¤å¾€å¾€å¾—åˆ°äº‚ç¢¼æˆ–ä¸å®Œæ•´æ•¸æ“š
- ğŸ¯ **æˆ‘å€‘çš„è§£æ±ºæ–¹æ¡ˆ**ï¼šå°‡ PDF è¦–ç‚ºè¦–è¦ºæ–‡ä»¶ï¼Œé€éç‰ˆé¢åˆ†æå’Œ OCR æå–å…§å®¹

### é©ç”¨å ´æ™¯

âœ… æƒææ–‡ä»¶ã€é›»å­æ›¸ã€èˆŠç‰ˆå ±å‘Š  
âœ… æ–‡ä»¶ç†è§£èˆ‡çŸ¥è­˜æå–  
âœ… åœ–ç‰‡è³‡æ–™é›†å»ºæ§‹  
âœ… çŸ¥è­˜åº« / RAG ç³»çµ±  
âœ… æœå°‹èˆ‡å•ç­”æ‡‰ç”¨  

---

## æ ¸å¿ƒç‰¹æ€§

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| **PDF å½±åƒåŒ–** | å°‡ä»»ä½•æ ¼å¼çš„ PDF çµ±ä¸€è½‰æ›ç‚ºé«˜è§£æåº¦åœ–ç‰‡ |
| **ç‰ˆé¢åˆ†æ** | è‡ªå‹•åµæ¸¬åœ–ç‰‡ã€æ–‡å­—ã€æ¨™é¡Œã€è¡¨æ ¼ç­‰å…ƒç´  |
| **åœ–ç‰‡æ“·å–** | ç²¾ç¢ºè£åˆ‡å’Œæå–åœ–ç‰‡ï¼Œä¸¦æŒ‡æ´¾å”¯ä¸€ ID |
| **æ™ºèƒ½ OCR** | é¸æ“‡æ€§ OCRï¼Œåªæƒæå¿…è¦å€åŸŸï¼Œé€Ÿåº¦å¿«ç²¾åº¦é«˜ |
| **ä¸Šä¸‹æ–‡ç†è§£** | è‡ªå‹•è’é›†åœ–ç‰‡å‘¨åœæ–‡å­—ä½œç‚ºåœ–èªªå€™é¸ |
| **çµæ§‹åŒ–è¼¸å‡º** | JSON æ ¼å¼è¼¸å‡ºï¼ŒåŒ…å«åœ–ç‰‡ã€åœ–èªªã€ä½ç½®ç­‰å®Œæ•´è¨Šæ¯ |

---

## ç³»çµ±æ¶æ§‹

```
PDF è¼¸å…¥
    â†“
[Step 1] é é¢å½±åƒåŒ– (Page Rendering)
    â”œâ”€ è½‰æ›ç‚º PNG åœ–ç‰‡ (DPI: 100-300)
    â””â”€ è¼¸å‡º: page_0001.png, page_0002.png, ...
    â†“
[Step 2] æ–‡ä»¶ç‰ˆé¢åˆ†æ (Layout Detection)
    â”œâ”€ è­˜åˆ¥å…ƒç´ : åœ–ç‰‡ã€æ–‡å­—ã€æ¨™é¡Œã€è¡¨æ ¼ã€åœ–èªª
    â”œâ”€ ä½¿ç”¨æ¨¡å‹: PP-DocLayout_plus-L
    â””â”€ è¼¸å‡º: å¸¶æœ‰åº§æ¨™å’Œé¡å‹çš„å€å¡Šè¨Šæ¯
    â†“
[Step 3] åœ–ç‰‡æ“·å– (Figure Extraction)
    â”œâ”€ æ ¹æ“šç‰ˆé¢åˆ†æçµæœè£åˆ‡åœ–ç‰‡
    â”œâ”€ ç”Ÿæˆå”¯ä¸€ ID (UUID)
    â””â”€ è¼¸å‡º: fig_page2_01.png, fig_page3_02.png, ...
    â†“
[Step 4] åœ–èªªå€™é¸è’é›† (Caption Candidate Collection)
    â”œâ”€ åŸºæ–¼è·é›¢ã€å°é½ã€æ¬„ä½ç­‰è¦å‰‡
    â”œâ”€ æ”¶é›†åœ–ç‰‡å‘¨åœçš„æ–‡å­—å€å¡Š
    â””â”€ è¼¸å‡º: å€™é¸å€å¡Šæ¸…å–®
    â†“
[Step 5] é¸æ“‡æ€§ OCR (Selective OCR)
    â”œâ”€ åªæƒæåœ–èªªå€™é¸å€åŸŸ
    â”œâ”€ è‡ªå‹•æª¢æ¸¬ä¸¦è™•ç†äº‚ç¢¼
    â””â”€ è¼¸å‡º: æå–çš„æ–‡å­—
    â†“
[Step 6] è¼¸å‡ºèˆ‡æ¨è«– (Inference & Export)
    â”œâ”€ æ•´åˆåœ–ç‰‡ + åœ–èªª + å…ƒæ•¸æ“š
    â””â”€ è¼¸å‡º: JSON + PNG æª”æ¡ˆ
```

---

## å®‰è£æŒ‡å—

### ç³»çµ±éœ€æ±‚

- Python 3.8+
- CUDA 11.0+ (é¸ç”¨ï¼Œç”¨æ–¼ GPU åŠ é€Ÿ)
- è‡³å°‘ 4GB RAM (å»ºè­° 8GB+)

### æ­¥é©Ÿ 1ï¼šå…‹éš†å°ˆæ¡ˆ

```bash
git clone https://github.com/tseng91301/pdf-image-extractor.git
cd pdf-image-extractor
```

### æ­¥é©Ÿ 2ï¼šå»ºç«‹è™›æ“¬ç’°å¢ƒï¼ˆæ¨è–¦ï¼‰

```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

### æ­¥é©Ÿ 3ï¼šå®‰è£ä¾è³´

```bash
pip install -r requirements.txt
```

### æ­¥é©Ÿ 4ï¼šé©—è­‰å®‰è£

```bash
python -c "from converter import PdfInfo; print('âœ… å®‰è£æˆåŠŸ')"
```

---

## å¿«é€Ÿé–‹å§‹

### æœ€ç°¡å–®çš„æ–¹å¼ï¼šä¸€éµæå–

```python
from converter import PdfInfo

# åˆå§‹åŒ–
pdf = PdfInfo('path/to/your/file.pdf')

# ä¸€éµåŸ·è¡Œå…¨æµç¨‹ï¼ˆæ¨è–¦ï¼‰
pdf.export_all_images_and_image_descriptions()

print("âœ… æå–å®Œæˆï¼æª¢æŸ¥è¼¸å‡ºè³‡æ–™")
```

**è¼¸å‡ºï¼š**
- æå–çš„åœ–ç‰‡ï¼š`tmp/ImgData/[uuid]/image.png`
- çµæ§‹åŒ–è³‡æ–™ï¼š`output/images_data.json`

---

## è©³ç´°ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šåˆ†æ­¥é©Ÿæ§åˆ¶

é©åˆéœ€è¦è‡ªå®šç¾©å„éšæ®µåƒæ•¸çš„é€²éšä½¿ç”¨è€…ã€‚

```python
from converter import PdfInfo

# åˆå§‹åŒ– PDF
pdf = PdfInfo('sample.pdf', gpu=False)  # è¨­ gpu=True å•Ÿç”¨ GPU åŠ é€Ÿ

# Step 1: PDF è½‰åœ–ç‰‡ï¼ˆDPI è¶Šé«˜å“è³ªè¶Šå¥½ï¼Œä½†é€Ÿåº¦è¶Šæ…¢ï¼‰
print("â–¶ æ­£åœ¨è½‰æ› PDF ç‚ºåœ–ç‰‡...")
pdf.to_images(dpi=100)  # é è¨­ 100 DPIï¼Œç²¾åº¦é«˜æ‡‰ç”¨å¯ç”¨ 200-300

# Step 2: ç‰ˆé¢åˆ†æ
print("â–¶ æ­£åœ¨åˆ†ææ–‡ä»¶ç‰ˆé¢...")
pdf.label_layout(output=False)  # output=True æœƒé¡¯ç¤ºåµæ¸¬çµæœ

# Step 3: åœ–ç‰‡æ“·å–èˆ‡æ¨™è¨˜
print("â–¶ æ­£åœ¨æ“·å–åœ–ç‰‡...")
pdf.label_images(
    optimize_resolution=False,  # True: å¾åŸ PDF é«˜è§£æåº¦æ“·å–åœ–ç‰‡
    optimize_dpi=500,          # é«˜è§£æåº¦æ™‚çš„ DPI
    use_xref=True              # ä½¿ç”¨ PDF å…§åµŒåœ–ç‰‡åƒè€ƒ
)

# Step 4: æå–åœ–èªªèˆ‡å‘¨åœæ–‡å­—
print("â–¶ æ­£åœ¨æå–åœ–èªª...")
pdf.extract_image_description(
    export=True,  # True: ç›´æ¥å„²å­˜çµæœ
    nl=False      # True: OCR çµæœæ›è¡Œé¡¯ç¤º
)

# æˆ–è€…æ‰‹å‹•åŒ¯å‡º
pdf.export_all_image_datas(path='output/images_data.json')
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ Google Colabï¼ˆç„¡éœ€æœ¬åœ°ç’°å¢ƒï¼‰

ç›´æ¥åŸ·è¡Œ `colab_entry.ipynb`ï¼š

```python
# Colab æœƒè‡ªå‹•å…‹éš†ä¸¦å®‰è£
!git clone https://github.com/tseng91301/pdf-image-extractor
!pip install -r pdf-image-extractor/requirements.txt

from converter import PdfInfo

pdf = PdfInfo('your_file.pdf')
pdf.export_all_images_and_image_descriptions()
```

---

## ç¨‹å¼é‹ä½œæµç¨‹

### æ ¸å¿ƒé¡ï¼š`PdfInfo`

```python
class PdfInfo:
    """ç®¡ç†æ•´å€‹ PDF è™•ç†æµç¨‹"""
    
    # ä¸»è¦å±¬æ€§
    pdf_path: str              # è¼¸å…¥ PDF è·¯å¾‘
    pdf_uid: str               # å”¯ä¸€è­˜åˆ¥ç¢¼ (UUID)
    pdf_name: str              # PDF æª”å
    pdf_doc: fitz.Document     # PyMuPDF æ–‡ä»¶ç‰©ä»¶
    use_gpu: bool              # æ˜¯å¦ä½¿ç”¨ GPU
    
    # è™•ç†çµæœ
    pdf_img_paths: list        # é é¢åœ–ç‰‡è·¯å¾‘
    pdf_layouts: list          # ç‰ˆé¢åˆ†æçµæœ
    pdf_imgdatas: list         # æå–çš„åœ–ç‰‡ç‰©ä»¶æ¸…å–®
```

### æ ¸å¿ƒé¡ï¼š`ImgData`

```python
class ImgData:
    """ä»£è¡¨ä¸€å€‹æå–çš„åœ–ç‰‡åŠå…¶å…ƒæ•¸æ“š"""
    
    # åœ–ç‰‡è¨Šæ¯
    uid: str                   # åœ–ç‰‡å”¯ä¸€ ID
    coordinate: list           # åº§æ¨™ [x1, y1, x2, y2]
    store_path: str            # å„²å­˜è·¯å¾‘
    
    # åœ–èªªè¨Šæ¯
    image_figure_title: str    # åœ–ç‰‡æ¨™é¡Œ
    image_surrounding_texts: list  # å‘¨åœæ–‡å­—æ¸…å–®
    
    # æ–¹æ³•
    get_surroundings()         # æå–å‘¨åœæ–‡å­—èˆ‡ä¸Šä¸‹æ–‡
    to_json()                  # è½‰æ›ç‚º JSON
```

### è³‡æ–™æµç¯„ä¾‹

```
PDF æª”æ¡ˆ
    â†“ (to_images)
[page_0001.png, page_0002.png, ...]
    â†“ (label_layout)
{
  "page": 0,
  "boxes": [
    {"type": "image", "coordinate": [100, 200, 500, 600]},
    {"type": "text", "coordinate": [100, 610, 500, 650], "text": "..."},
    ...
  ]
}
    â†“ (label_images)
ImgData(uid="abc123", coordinate=[100, 200, 500, 600], ...)
    â†“ (extract_image_description)
{
  "uid": "abc123",
  "figure_title": "åœ– 1ï¼šæ¶æ§‹åœ–",
  "surrounding_texts": ["ä¸Šæ–‡...", "ä¸‹æ–‡..."],
  "image_path": "tmp/ImgData/abc123/image.png"
}
```

---

## è¼¸å‡ºæ ¼å¼

### JSON è¼¸å‡ºçµæ§‹

```json
{
  "pdf_name": "report_2024",
  "total_pages": 5,
  "total_images": 3,
  "imgs": [
    {
      "uid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "page": 1,
      "coordinate": [100, 200, 500, 600],
      "figure_title": "åœ– 1ï¼šç³»çµ±æ¶æ§‹",
      "figure_title_box": {
        "coordinate": [100, 610, 500, 630],
        "text": "åœ– 1ï¼šç³»çµ±æ¶æ§‹"
      },
      "surrounding_texts": [
        {
          "text": "æœ¬ç³»çµ±æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆ...",
          "box": [100, 50, 500, 100],
          "type": "text"
        }
      ],
      "image_path": "tmp/ImgData/a1b2c3d4-e5f6-7890-abcd-ef1234567890/image.png"
    }
  ]
}
```

### æª”æ¡ˆè¼¸å‡º

```
output/
â”œâ”€â”€ images_data.json           # å®Œæ•´çš„å…ƒæ•¸æ“š
â”œâ”€â”€ extracted_images/
â”‚   â”œâ”€â”€ page_0001.png
â”‚   â”œâ”€â”€ page_0002.png
â”‚   â””â”€â”€ ...
â””â”€â”€ figures/
    â”œâ”€â”€ a1b2c3d4.../image.png
    â”œâ”€â”€ b2c3d4e5.../image.png
    â””â”€â”€ ...
```

---

## é—œéµæŠ€è¡“

| æŠ€è¡“ | ç”¨é€” | å‚™è¨» |
|------|------|------|
| **PyMuPDF (fitz)** | PDF æ¸²æŸ“èˆ‡åœ–ç‰‡æå– | æ”¯æ´é«˜ DPIã€é«˜é€Ÿ |
| **PaddleOCR** | å…‰å­¸å­—ç¬¦è­˜åˆ¥ | æ”¯æ´ç¹é«”ä¸­æ–‡ï¼Œç²¾åº¦é«˜ |
| **PP-DocLayout_plus-L** | æ–‡ä»¶ç‰ˆé¢åˆ†æ | æ”¯æ´å¤šç¨®æ–‡ä»¶é¡å‹ |
| **OpenCV** | åœ–åƒè™•ç† | ç”¨æ–¼åœ–ç‰‡è£åˆ‡ã€æª¢æ¸¬ |
| **Sentence Transformers** | èªç¾©æª¢ç´¢ | FAISS å‘é‡æœå°‹ (å¯é¸) |
| **FAISS** | ç›¸ä¼¼åº¦æœå°‹ | ç”¨æ–¼åœ–ç‰‡ã€æ–‡å­—æª¢ç´¢ |

---

## å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æå–å‡ºä¾†æ˜¯äº‚ç¢¼ï¼Ÿ

**åŸå› **ï¼šPDF çš„æ–‡å­—å±¤æˆ–å­—å‹æ˜ å°„æå£

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```python
# ç³»çµ±æœƒè‡ªå‹•æª¢æ¸¬ä¸¦ä½¿ç”¨ OCR
pdf.extract_image_description(nl=False)
```

### Q2: åœ–ç‰‡å“è³ªä¸å¥½æ€éº¼è¾¦ï¼Ÿ

**æå‡å“è³ª**ï¼š

```python
# ä½¿ç”¨æ›´é«˜çš„ DPI
pdf.to_images(dpi=200)  # é è¨­ 100ï¼Œå¯æå‡åˆ° 200-300

# æˆ–å„ªåŒ–æå–è§£æåº¦
pdf.label_images(
    optimize_resolution=True,
    optimize_dpi=500      # å¾åŸ PDF é«˜è§£æåº¦æ“·å–
)
```

### Q3: è™•ç†é€Ÿåº¦å¤ªæ…¢ï¼Ÿ

**åŠ é€Ÿæ–¹æ¡ˆ**ï¼š
```python
# ä½¿ç”¨ GPU åŠ é€Ÿ
pdf = PdfInfo('file.pdf', gpu=True)

# æˆ–é™ä½ DPI (çŠ§ç‰²å“è³ªæ›é€Ÿåº¦)
pdf.to_images(dpi=75)
```

### Q4: å¯ä»¥è‡ªå®šç¾©è¼¸å‡ºä½ç½®å—ï¼Ÿ

```python
# è‡ªå®šç¾©è¼¸å‡ºè·¯å¾‘
pdf.export_all_image_datas(path='my_custom_output/data.json')
```

### Q5: å¦‚ä½•æ‰¹é‡è™•ç†å¤šå€‹ PDFï¼Ÿ

```python
import os
from converter import PdfInfo

pdf_dir = 'path/to/pdfs'
for pdf_file in os.listdir(pdf_dir):
    if pdf_file.endswith('.pdf'):
        pdf = PdfInfo(os.path.join(pdf_dir, pdf_file))
        pdf.export_all_images_and_image_descriptions()
        print(f"âœ… å®Œæˆ: {pdf_file}")
```

---

## é–‹ç™¼é€²åº¦

### âœ… å·²å®Œæˆ (Phase 1: MVP)

- [x] PDF â†’ é é¢å½±åƒè½‰æ›
- [x] åŸºæœ¬ç‰ˆé¢åˆ†æï¼ˆåœ–ç‰‡ï¼‹æ–‡å­—ï¼‰
- [x] åœ–ç‰‡è£åˆ‡èˆ‡ ID æŒ‡æ´¾
- [x] è·é›¢èˆ‡æ¬„ä½è¦å‰‡çš„åœ–èªªå€™é¸è’é›†
- [x] å€å¡Šç´š OCR
- [x] è¼¸å‡ºåœ–ç‰‡ï¼‹JSON çµæœ

### ğŸš§ é€²è¡Œä¸­ (Phase 2: åŠŸèƒ½æ“´å±•)

- [ ] è¡¨æ ¼è­˜åˆ¥èˆ‡æå–
- [ ] å¤šèªè¨€æ”¯æ´å„ªåŒ–
- [ ] GPU åŠ é€Ÿå®Œå…¨æ”¯æ´
- [ ] æ‰¹é‡è™•ç† UI

### ğŸ“‹ è¨ˆç•«ä¸­ (Phase 3: é«˜ç´šåŠŸèƒ½)

- [ ] ä½¿ç”¨ LLM é€²è¡Œæ™ºèƒ½åœ–èªªæ¨è«–
- [ ] å‘é‡æœå°‹æ•´åˆ
- [ ] çŸ¥è­˜åœ–è­œæå–
- [ ] ç•°æ­¥è™•ç†èˆ‡åˆ†ä½ˆå¼æ”¯æ´

---

## ä¾è³´åˆ—è¡¨

```
numpy                          # æ•¸å€¼è¨ˆç®—
opencv-python                  # åœ–åƒè™•ç†
Pillow                         # åœ–ç‰‡æ“ä½œ
PyMuPDF                        # PDF è™•ç†
paddleocr                      # å…‰å­¸å­—ç¬¦è­˜åˆ¥
paddlepaddle==3.2.2           # PaddleOCR å¾Œç«¯
matplotlib                     # è¦–è¦ºåŒ–
sentence-transformers          # èªç¾© embedding
faiss-cpu                      # å‘é‡æœå°‹
```

> ğŸ“Œ ä½¿ç”¨ `pip install -r requirements.txt` è‡ªå‹•å®‰è£æ‰€æœ‰ä¾è³´

---

## è¨±å¯è¨¼

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT License

---

## è¯çµ¡èˆ‡åé¥‹

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œæ­¡è¿æå‡º Issue æˆ– Pull Requestï¼

**ä½œè€…**: [@tseng91301](https://github.com/tseng91301)  
**Last Updated**: 2026-01-30
